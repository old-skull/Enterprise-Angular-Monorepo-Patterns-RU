# Заметки об использовании библиотек

### The Barrel File

Когда мы используем Nx и @nrwl/schematics для создания библиотеки, выполняется несколько шагов. Самым важным является создание barrel файла.

Вот файлы, создаваемые при создании библиотеки с названием <mark style="color:red;">`data-access`</mark> в <mark style="color:red;">`shared`</mark>:

```
jest.config.js (1)
src/
  index.ts (2)
  lib/
    shared-data-access.module.spec.ts
    shared-data-access.module.ts
  test-setup.ts
tsconfig.lib.json
tsconfig.spec.json
tslint.json
```

1. В качестве фреймворка для тестирования данной библиотеки был выбран jest.
2. Barrel файл.

Обратите внимание, что файл <mark style="color:red;">`index.ts`</mark> находится в папке <mark style="color:red;">`src/`</mark>. Это **barrel** файл для библиотеки. Он содержит общедоступный API для взаимодействия с библиотекой, и мы должны убедиться, что все константы, перечисления (enums), классы, функции и т.д., которые мы хотим "показать" вне библиотеки, экспортированы в этот файл.

Nx настраивает это в корневом файле tsconfig.json, который будет содержать следующую запись:

{% code overflow="wrap" %}
```json
// Конфигурация алиаса пути для нашей библиотеки
"paths": {
  ...
  "@nrwl-airlines/shared/data-access": [
    "libs/shared/data-access/src/index.ts"
  ]
  ...
}
```
{% endcode %}

Вышеприведенное позволяет нам написать <mark style="color:red;">`import * from '@nrwl-airlines/shared/data-access';`</mark> в любом месте нашего рабочего пространства и указывает typescript'у импортировать содержимое barrel файла (хотя мы должны импортировать конкретные сущности из barrel файла вместо использования <mark style="color:red;">`*`</mark>).

Каждое приложение и библиотека, которые мы создаем с помощью CLI, получают запись в этом файле, чтобы помочь в маппинге с использованием синтаксиса <mark style="color:red;">`@`</mark> для пути относительно рабочего пространства. Вы можете создавать свои собственные алиасы похожим образом, если это поможет в разработке.

Давайте рассмотрим, когда нам следует использовать этот алиас в рабочем пространстве, а когда нет.

### Относительные пути vs. с использование алиаса рабочего пространства

Компоненты и классы, **содержащиеся в библиотеке**, должны импортироваться только с относительными путями. Обращение к ним с использованием относительного пути к рабочему пространству приводит к ошибкам линтинга.

Компоненты и сервисы, импортируемые **из-за пределов** текущей библиотеки, должны использовать npmScoped imports (например, <mark style="color:red;">`@myOrg/customers/`</mark>) вместо относительных путей.

Правила TsLint были настроены на отображение ошибок при нарушении вышеперечисленного.

После того, как наша библиотека создана, нам необходимо проинформировать других разработчиков о том, для чего она нужна, как ее использовать и какие ограничения могут быть при ее использовании.
